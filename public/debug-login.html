<!DOCTYPE html>
<html>

<head>
    <title>Login Debug Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            background: #00ff00;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }

        input {
            padding: 10px;
            margin: 10px 0;
            width: 300px;
            font-size: 14px;
        }

        .output {
            background: #000;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #00ff00;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>
    <h1>Login Debug Tool</h1>

    <div>
        <button onclick="checkStorage()">1. Check localStorage Users</button>
        <button onclick="clearAll()">2. Clear All Storage</button>
    </div>

    <div>
        <button onclick="addTestUser()">3. Add Test User (invictus)</button>
    </div>

    <div>
        <h3>Try Login:</h3>
        <input type="text" id="testUsername" placeholder="Username" value="invictus">
        <input type="password" id="testPassword" placeholder="Password" value="oussama1234">
        <button onclick="testLogin()">4. Test Login Logic</button>
    </div>

    <div class="output" id="output">Output will appear here...</div>

    <script>
        const output = document.getElementById('output');

        function log(message) {
            output.textContent += message + '\n';
        }

        function clear() {
            output.textContent = '';
        }

        function checkStorage() {
            clear();
            log('=== CHECKING LOCALSTORAGE ===');
            const users = localStorage.getItem('users');
            log('Raw users data: ' + users);

            if (users) {
                const parsed = JSON.parse(users);
                log('\nParsed users array:');
                log(JSON.stringify(parsed, null, 2));
                log('\nTotal users: ' + parsed.length);
            } else {
                log('No users found in localStorage');
            }
        }

        function clearAll() {
            clear();
            localStorage.clear();
            sessionStorage.clear();
            log('=== STORAGE CLEARED ===');
            log('localStorage and sessionStorage have been cleared.');
        }

        function addTestUser() {
            clear();
            const testUser = {
                username: "invictus",
                email: "oussama.rajawious@gmail.com",
                password: "oussama1234",
                createdAt: "2025-11-22T22:43:14.371Z",
                lastConnected: null
            };

            localStorage.setItem('users', JSON.stringify([testUser]));
            log('=== TEST USER ADDED ===');
            log(JSON.stringify(testUser, null, 2));
            log('\nNow try to login with:');
            log('Username: invictus');
            log('Password: oussama1234');
        }

        function testLogin() {
            clear();
            log('=== TESTING LOGIN LOGIC ===\n');

            const enteredUsername = document.getElementById('testUsername').value;
            const enteredPassword = document.getElementById('testPassword').value;

            log('Entered username: "' + enteredUsername + '"');
            log('Entered password: "' + enteredPassword + '"');
            log('');

            const users = JSON.parse(localStorage.getItem('users')) || [];
            log('Users in localStorage: ' + users.length);
            log('');

            if (users.length === 0) {
                log('ERROR: No users found! Click "Add Test User" first.');
                return;
            }

            log('Checking each user:');
            users.forEach((user, index) => {
                log(`\nUser ${index}:`);
                log('  Stored username: "' + user.username + '"');
                log('  Stored password: "' + user.password + '"');
                log('  Username match: ' + (user.username === enteredUsername));
                log('  Password match: ' + (user.password === enteredPassword));
                log('  Both match: ' + (user.username === enteredUsername && user.password === enteredPassword));
            });

            const userIndex = users.findIndex(user => user.username === enteredUsername && user.password === enteredPassword);

            log('\n=== RESULT ===');
            if (userIndex !== -1) {
                log('✓ LOGIN SUCCESS!');
                log('User found at index: ' + userIndex);
                log('User data: ' + JSON.stringify(users[userIndex], null, 2));
            } else {
                log('✗ LOGIN FAILED!');
                log('No matching user found.');
                log('\nPossible issues:');
                log('- Username or password has extra spaces');
                log('- Case sensitivity (try exact match)');
                log('- User not in localStorage');
            }
        }
    </script>
</body>

</html>